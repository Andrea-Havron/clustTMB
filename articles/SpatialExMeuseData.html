<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meuse Data Example • clustTMB</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Meuse Data Example">
<meta property="og:description" content="clustTMB">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">clustTMB</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="far fa-file-code fa-lg"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="https://github.com/Andrea-Havron/clustTMB/issues" class="external-link">
    <span class="fas fa-question-circle fa-lg"></span>
     
    Issues
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-file-contract fa-lg"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CovarianceStructure.html">Covariance Structures</a>
    </li>
    <li>
      <a href="../articles/SpatialExMeuseData.html">Spatial Example - Meuse Dataset</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Andrea-Havron/clustTMB" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
    Source Code
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="SpatialExMeuseData_files/kePrint-0.0.1/kePrint.js"></script><link href="SpatialExMeuseData_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Meuse Data Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Andrea-Havron/clustTMB/blob/HEAD/vignettes/SpatialExMeuseData.Rmd" class="external-link"><code>vignettes/SpatialExMeuseData.Rmd</code></a></small>
      <div class="hidden name"><code>SpatialExMeuseData.Rmd</code></div>

    </div>

    
    
<p>This vignette provides examples of setting up non-spatial and spatial
finite mixture models (FMMs) using clustTMB.</p>
<div class="section level2">
<h2 id="fitting-clusttmb-models">Fitting clustTMB models<a class="anchor" aria-label="anchor" href="#fitting-clusttmb-models"></a>
</h2>
<div class="section level3">
<h3 id="data-overview">Data Overview<a class="anchor" aria-label="anchor" href="#data-overview"></a>
</h3>
<p>The meuse data set from the sp library (Pebesma and Bivand, 2005)
consists of 155 observations, 4 response variables, location data, and 8
covariates. The response involves four heavy metals measured to monitor
pollution levels in the top soil of the Meuse river floodplain,
Netherlands (Fig. @ref(fig:sample), Rikken and van Rijn, 1993). The
heavy metal data exhibit lognormality (Fig. @ref(fig:pairs-expl)),
allowing for a comparison between the Gaussian and lognormal
distributions in addition to an FMM with and without spatial structure
influencing the cluster probability.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/" class="external-link">sp</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"meuse"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"meuse.riv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"meuse.grid"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use the `linewidth` argument instead.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<div class="figure">
<img src="SpatialExMeuseData_files/figure-html/sample-1.png" alt="Sample locations of heavy metal concentration levels (ppm) of four metals in the topsoil of the Meuse river floodplain, Netherlands." width="576"><p class="caption">
Sample locations of heavy metal concentration levels (ppm) of four
metals in the topsoil of the Meuse river floodplain, Netherlands.
</p>
</div>
<div class="figure">
<img src="SpatialExMeuseData_files/figure-html/pairs-expl-1.png" alt="Pairs plots of the concentration levels (ppm) of four heavy metals measured in the topsoil of the Meuse river floodplain, Netherlands." width="576"><p class="caption">
Pairs plots of the concentration levels (ppm) of four heavy metals
measured in the topsoil of the Meuse river floodplain, Netherlands.
</p>
</div>
</div>
<div class="section level3">
<h3 id="simple-fmm">Simple FMM<a class="anchor" aria-label="anchor" href="#simple-fmm"></a>
</h3>
<p>The simple Gaussian FMM can be fit using the following code:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Andrea-Havron/clustTMB" class="external-link">clustTMB</a></span><span class="op">)</span></span>
<span><span class="va">mod.gauss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clustTMB.html">clustTMB</a></span><span class="op">(</span>response <span class="op">=</span> <span class="va">meuse</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, G <span class="op">=</span> <span class="fl">3</span>, covariance.structure <span class="op">=</span> <span class="st">"VVV"</span><span class="op">)</span></span></code></pre></div>
<p>Specifying a lognormal distribution is implemented using the
<em>family</em> and <em>link</em> specification:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod.ln</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clustTMB.html">clustTMB</a></span><span class="op">(</span></span>
<span>  response <span class="op">=</span> <span class="va">meuse</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/lognormal.html">lognormal</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">3</span>, covariance.structure <span class="op">=</span> <span class="st">"VVV"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="spatial-fmm">Spatial FMM<a class="anchor" aria-label="anchor" href="#spatial-fmm"></a>
</h3>
<p>The inclusion of spatial random effects in the expectation of the
cluster probability in clustTMB depends on the SPDE-FEM approximation to
a spatial Gaussian Markov Random Field (GMRF) introduced by the package,
<a href="https://www.r-inla.org/" class="external-link">R-INLA</a>. See <a href="#spatial-gmrf">Spatial GMRF</a> and <a href="#gating-network">Gating Network</a> for details on these clustTMB
formulations. The <a href="https://inlabru-org.github.io/fmesher" class="external-link">fmesher R package</a> (<a href="https://github.com/inlabru-org/fmesher" class="external-link">github source code</a>) is
used to run functions needed to implement this SPDE-FEM method.</p>
<div class="section level4">
<h4 id="setting-up-the-spatial-mesh">Setting up the spatial mesh<a class="anchor" aria-label="anchor" href="#setting-up-the-spatial-mesh"></a>
</h4>
<p>The spatial model in clustTMB first requires the definition of the
spatial mesh. This mesh defines the discretization of the continuous
space using a constrained Delaunay triangulation. For details on
building the spatial mesh, see <a href="https://becarioprecario.bitbucket.io/spde-gitbook/ch-intro.html#sec:mesh" class="external-link">Krainski
et al., 2021, Sec 2.6</a>.</p>
<p>As an example, the spatial mesh for the meuse data is built using the
fmesher functions, fm_nonconvex_hull() to set up the boundary and
fm_mesh_2d() to generate the spatial mesh:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://inlabru-org.github.io/fmesher/" class="external-link">fmesher</a></span><span class="op">)</span> </span>
<span><span class="va">loc</span> <span class="op">&lt;-</span> <span class="va">meuse</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">Bnd</span> <span class="op">&lt;-</span> <span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_nonconvex_hull.html" class="external-link">fm_nonconvex_hull</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">loc</span><span class="op">)</span>, convex <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">meuse.mesh</span> <span class="op">&lt;-</span> <span class="fu">fmesher</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_mesh_2d.html" class="external-link">fm_mesh_2d</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">loc</span><span class="op">)</span>,</span>
<span>  max.edge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  boundary <span class="op">=</span> <span class="va">Bnd</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The inlabru R package can be used to visualize the mesh:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">inlabru</span><span class="fu">::</span><span class="fu"><a href="https://inlabru-org.github.io/inlabru/reference/gg.html" class="external-link">gg</a></span><span class="op">(</span><span class="va">meuse.mesh</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">loc</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">loc</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required namespace: INLA</span></span></code></pre>
<p><img src="SpatialExMeuseData_files/figure-html/fig1-1.png" width="384"></p>
</div>
<div class="section level4">
<h4 id="fitting-a-spatial-model-with-clusttmb">Fitting a spatial model with clustTMB<a class="anchor" aria-label="anchor" href="#fitting-a-spatial-model-with-clusttmb"></a>
</h4>
<p>Coordinates are converted to a spatial point data frame and read into
the clustTMB model, along with the mesh, using the spatial.list
argument. Spatial projections can be generated by defining a spatial
data frame of prediction coordinates. These can be passed into the model
via the projection.dat argument of clustTMB. The gating formula is
specified using the gmrf() command:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># convert coordinates to a spatial point data frame</span></span>
<span><span class="va">Loc</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">loc</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define spatial prediction coordinates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"meuse.grid"</span><span class="op">)</span></span>
<span><span class="va">Meuse.Grid</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">meuse.grid</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod.ln.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clustTMB.html">clustTMB</a></span><span class="op">(</span></span>
<span>  response <span class="op">=</span> <span class="va">meuse</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/lognormal.html">lognormal</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>,</span>
<span>  gatingformula <span class="op">=</span> <span class="op">~</span> <span class="fu">gmrf</span><span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">loc</span><span class="op">)</span>,</span>
<span>  G <span class="op">=</span> <span class="fl">4</span>, covariance.structure <span class="op">=</span> <span class="st">"VVV"</span>,</span>
<span>  spatial.list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>loc <span class="op">=</span> <span class="va">Loc</span>, mesh <span class="op">=</span> <span class="va">meuse.mesh</span><span class="op">)</span>,</span>
<span>  projection.dat <span class="op">=</span> <span class="va">Meuse.Grid</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Results can be viewed via model output:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimated fixed parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.ln.sp</span><span class="op">$</span><span class="va">sdr</span>, <span class="st">"fixed"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             Estimate Std. Error</span></span>
<span><span class="co">## betag      0.1779633 0.51240693</span></span>
<span><span class="co">## betag      0.5710262 0.50603382</span></span>
<span><span class="co">## betag      0.1653805 0.50250754</span></span>
<span><span class="co">## betad      2.0157754 0.09100866</span></span>
<span><span class="co">## betad      4.3160879 0.03898689</span></span>
<span><span class="co">## betad      5.4259854 0.08790546</span></span>
<span><span class="co">## betad      6.7095846 0.08920058</span></span>
<span><span class="co">## betad      1.0064930 0.03967251</span></span>
<span><span class="co">## betad      3.6030490 0.03008720</span></span>
<span><span class="co">## betad      5.2113133 0.04647324</span></span>
<span><span class="co">## betad      6.2155349 0.04387996</span></span>
<span><span class="co">## betad      0.1259768 0.06249992</span></span>
<span><span class="co">## betad      3.1475084 0.02038053</span></span>
<span><span class="co">## betad      4.2016906 0.04031252</span></span>
<span><span class="co">## betad      5.2523426 0.03330884</span></span>
<span><span class="co">## betad     -1.4361462 0.05510453</span></span>
<span><span class="co">## betad      3.1132983 0.03560914</span></span>
<span><span class="co">## betad      4.2118618 0.04706059</span></span>
<span><span class="co">## betad      5.1996603 0.04976633</span></span>
<span><span class="co">## theta     -1.2100823 0.16013168</span></span>
<span><span class="co">## theta     -2.9055409 0.19071054</span></span>
<span><span class="co">## theta     -1.2794678 0.15756966</span></span>
<span><span class="co">## theta     -1.2502165 0.13950098</span></span>
<span><span class="co">## theta     -2.5623734 0.17078908</span></span>
<span><span class="co">## theta     -3.1154904 0.13779699</span></span>
<span><span class="co">## theta     -2.2459369 0.13350909</span></span>
<span><span class="co">## theta     -2.3607750 0.13177483</span></span>
<span><span class="co">## theta     -1.8075105 0.17469387</span></span>
<span><span class="co">## theta     -4.0486806 0.19343411</span></span>
<span><span class="co">## theta     -2.6845167 0.14489455</span></span>
<span><span class="co">## theta     -3.0661953 0.15617981</span></span>
<span><span class="co">## theta     -2.4648421 0.25661389</span></span>
<span><span class="co">## theta     -3.3381013 0.23942344</span></span>
<span><span class="co">## theta     -2.7804343 0.20017039</span></span>
<span><span class="co">## theta     -2.6686288 0.19753390</span></span>
<span><span class="co">## ln_kappag -5.9132661 0.28190919</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Minimum negative log likelihood</span></span>
<span><span class="va">mod.ln.sp</span><span class="op">$</span><span class="va">opt</span><span class="op">$</span><span class="va">objective</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2318.892</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="comparison-case-study">Comparison Case Study<a class="anchor" aria-label="anchor" href="#comparison-case-study"></a>
</h2>
<p>A cluster analysis was run on the meuse dataset using the Gaussian
and lognormal family with and without spatial random effects in the
gating network for clusters ranging from 2 to 10. BIC scores favored the
lognormal spatial model with 4 clusters (Table @ref(tab:BIC)). This
model resulted in fewer clusters compared to the spatial Gaussian
model.</p>
<table class="table table" style="margin-left: auto; margin-right: auto;">
<caption>
Optimum cluster size and BIC scores for lognormal and Gaussian models
with (1) and without (0) spatial random effects in the gating network.
</caption>
<thead><tr>
<th style="text-align:left;">
family
</th>
<th style="text-align:right;">
space
</th>
<th style="text-align:right;">
clusters
</th>
<th style="text-align:right;">
BIC
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
lognormal
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4805
</td>
</tr>
<tr>
<td style="text-align:left;">
lognormal
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4861
</td>
</tr>
<tr>
<td style="text-align:left;">
Gaussian
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
4861
</td>
</tr>
<tr>
<td style="text-align:left;">
Gaussian
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4910
</td>
</tr>
</tbody>
</table>
<p>Results from the optimal model suggested a spatial pattern where the
highest ppm observations for all four metals were clustered together
(Cluster 0) in a narrow strip along the bank of the Meuse River within
the northwest corner of the floodplain (Fig. @ref(fig:pairs), Fig.
@ref(fig:pred)). A separate cluster (Cluster 3) was characterized by low
ppm values for all metals and was spatially distributed in the central
region of the floodplain. The other two clusters were characterized by
moderately low (Cluster 2) and moderately high (Cluster 1) ppm values
for all metals. Spatial predictions of clustered heavy metals in the
Meuse River floodplain (Fig. @ref(fig:pred)) can aid in risk assessment
and environmental mitigation measures after flood events.</p>
<div class="figure">
<img src="SpatialExMeuseData_files/figure-html/pairs-1.png" alt="Pairs plots of the concentration levels (ppm) of four heavy metals measured in the topsoil of the Meuse river floodplain, Netherlands. Colors represent the four clusters estimated in the spatial lognormal FMM." width="576"><p class="caption">
Pairs plots of the concentration levels (ppm) of four heavy metals
measured in the topsoil of the Meuse river floodplain, Netherlands.
Colors represent the four clusters estimated in the spatial lognormal
FMM.
</p>
</div>
<div class="figure">
<img src="SpatialExMeuseData_files/figure-html/pred-1.png" alt="Predicted cluster distribution of heavy metal concentration levels (ppm) of four metals in the topsoil of the Meuse river floodplain, Netherlands. Colors represent the four clusters estimated in the spatial lognormal FMM." width="576"><p class="caption">
Predicted cluster distribution of heavy metal concentration levels (ppm)
of four metals in the topsoil of the Meuse river floodplain,
Netherlands. Colors represent the four clusters estimated in the spatial
lognormal FMM.
</p>
</div>
</div>
<div class="section level2">
<h2 id="clusttmb-formulations">clustTMB Formulations<a class="anchor" aria-label="anchor" href="#clusttmb-formulations"></a>
</h2>
<div class="section level3">
<h3 id="spatial-gmrf">Spatial GMRF<a class="anchor" aria-label="anchor" href="#spatial-gmrf"></a>
</h3>
<p>clustTMB fits spatial random effects using a Gaussian Markov Random
Field (GMRF). The precision matrix, <span class="math inline">\(Q\)</span>, of the GMRF is the inverse of a Matern
covariance function and takes two parameters: 1) <span class="math inline">\(\kappa\)</span>, which is the spatial decay
parameter and a scaled function of the spatial range, <span class="math inline">\(\phi = \sqrt{8}/\kappa\)</span>, the distance at
which two locations are considered independent; and 2) <span class="math inline">\(\tau\)</span>, which is a function of <span class="math inline">\(\kappa\)</span> and the marginal spatial variance
<span class="math inline">\(\sigma^{2}\)</span>:</p>
<p><span class="math display">\[\tau =
\frac{1}{2\sqrt{\pi}\kappa\sigma}.\]</span> The precision matrix is
approximated following the SPDE-FEM approach, where a constrained
Delaunay triangulation network is used to discretize the spatial extent
in order to determine a GMRF for a set of irregularly spaced locations,
<span class="math inline">\(i\)</span>. For details on the SPDE-FEM
approach, see <a href="https://becarioprecario.bitbucket.io/spde-gitbook/ch-intro.html#sec:spde" class="external-link">Krainski
et al., 2021, Sec. 2.2</a></p>
<p><span class="math display">\[\omega_{i} \sim GMRF(Q[\kappa,
\tau])\]</span></p>
</div>
<div class="section level3">
<h3 id="gating-network">Gating Network<a class="anchor" aria-label="anchor" href="#gating-network"></a>
</h3>
<p>When random effects, <span class="math inline">\(\mathbb{u}\)</span>,
are specified in the gating network, the probability of cluster
membership <span class="math inline">\(\pi_{i,g}\)</span> for
observation <span class="math inline">\(i\)</span> is fit using
multinomial regression:</p>
<p><span class="math display">\[
\begin{align}
\mathbb{\eta}_{,g} &amp;= X\mathbb{\beta}_{,g} + \mathbb{u}_{,g} \\
\mathbb{\pi}_{,g} &amp;= \frac{
exp(\mathbb{\eta}_{,g})}{\sum^{G}_{g=1}exp(\mathbb{\eta}_{,g})}
\end{align}
\]</span></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Andrea M. Havron.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
